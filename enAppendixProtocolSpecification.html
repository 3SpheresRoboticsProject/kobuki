<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>kobuki_driver: Appendix : Protocol Specification</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Appendix : Protocol Specification </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#enAppendixProtocolOverview">Overview</a></li>
<li class="level1"><a href="#enBytestream">Structure of Bytestream</a><ul><li class="level2"><a href="#enHeader">Header</a></li>
<li class="level2"><a href="#enLength">Length</a></li>
<li class="level2"><a href="#enPayload">Payload</a><ul><li class="level3"><a href="#enStructureOfPayload">Structure Of Payload</a></li>
<li class="level3"><a href="#enStructureOfSubPayloads">Structure Of Sub-Payloads</a></li>
</ul>
</li>
<li class="level2"><a href="#enChecksum">Checksum</a></li>
<li class="level2"><a href="#enEntireBytestream">Entire Bytestream</a></li>
</ul>
</li>
<li class="level1"><a href="#enDataTypes">Data Types</a><ul><li class="level2"><a href="#enSerializationDerialization">Serialization-Deserialization</a></li>
</ul>
</li>
<li class="level1"><a href="#enCommandPackets">Command Packets</a><ul><li class="level2"><a href="#enCommandIdentifier">Command Identifier</a></li>
<li class="level2"><a href="#enBaseControl">Base Control</a></li>
<li class="level2"><a href="#enSound">Sound</a></li>
<li class="level2"><a href="#enSoundSequence">Sound Sequence</a></li>
<li class="level2"><a href="#enRequestExtra">Request Extra</a></li>
<li class="level2"><a href="#enGeneralPurposeOutput">General Purpose Output</a></li>
<li class="level2"><a href="#enSetControllerGain">Set Controller Gain</a></li>
<li class="level2"><a href="#enGetControllerGain">Get Controller Gain</a></li>
</ul>
</li>
<li class="level1"><a href="#enFeedbackPackets">Feedback Packets</a><ul><li class="level2"><a href="#enFeedbackIdentifier">Feedback Identifier</a></li>
<li class="level2"><a href="#enBasicSensorData">Basic Sensor Data</a></li>
<li class="level2"><a href="#enDockingIR">Docking IR</a></li>
<li class="level2"><a href="#enInertialSensorData">Inertial Sensor Data</a></li>
<li class="level2"><a href="#enCliffSensorData">Cliff Sensor Data</a></li>
<li class="level2"><a href="#enCurrent">Current</a></li>
<li class="level2"><a href="#enHardwareVersion">Hardware Version</a></li>
<li class="level2"><a href="#enFirmwareVersion">Firmware Version</a></li>
<li class="level2"><a href="#enRawDataOf3DGyro">Raw Data Of 3D Gyro</a></li>
<li class="level2"><a href="#enGeneralPurposeInput">General Purpose Input</a></li>
<li class="level2"><a href="#enUniqueDeviceIDentifier">Unique Device IDentifier(UDID)</a></li>
<li class="level2"><a href="#enControllerInfo">Controller Info</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="enAppendixProtocolOverview"></a>
Overview</h1>
<p>The <a class="el" href="classkobuki_1_1Kobuki.html">kobuki driver</a> communicates with the robot by using predefined protocol. In general, the driver sends the commands to the robot and the robot sends some feedback data or sensor readings. These commands and feedback data are converted into bytestreams for communication via serial interface. The protocol specifies that rules and forms of bytestreams.</p>
<h1><a class="anchor" id="enBytestream"></a>
Structure of Bytestream</h1>
<p>A bytestream can be divided into 4 fields; Headers, Length, Payload and Checksum.</p>
<table class="doxtable">
<tr align="center">
<th>Name</th><td>Header 0</td><td>Header 1</td><td>Length</td><td>Payload</td><td>Checksum </td></tr>
<tr align="center">
<th>Size</th><td>1 Byte</td><td>1 Byte</td><td>1 Byte</td><td>N Bytes</td><td>1 Byte </td></tr>
<tr align="center">
<th align="center">Description</th><td width="100">0xAA<br />
(Fixed)</td><td width="100">0x55<br />
(Fixed)</td><td width="100">Size of payload in bytes</td><td width="100">Described below</td><td width="100">XOR'ed value of every bytes of bytesream except headers </td></tr>
</table>
<p><br />
</p>
<h2><a class="anchor" id="enHeader"></a>
Header</h2>
<p>Two bytes of headers, header 0 and header 1, are fixed value for both bytestreams, commands and feedback data. This headers are used to detect the starting point of bytestream.</p>
<p><br />
</p>
<h2><a class="anchor" id="enLength"></a>
Length</h2>
<p>Length indicates the length of following bytes that single bytestream hold. Default size of this field is 1 byte. Length can be used to distinguish each bytestreams. Minimum value of this field is 3.</p>
<p><br />
</p>
<h2><a class="anchor" id="enPayload"></a>
Payload</h2>
<p>Payload contains actual data of bytestream.</p>
<p><br />
</p>
<dl class="section user"><dt></dt><dd></dd></dl>
<h3><a class="anchor" id="enStructureOfPayload"></a>
Structure Of Payload</h3>
<dl class="section user"><dt></dt><dd>Payload is a consist of several sub-payloads.</dd></dl>
<dl class="section user"><dt></dt><dd><table class="doxtable">
<tr align="center">
<td colspan="5">Payload </td></tr>
<tr align="center">
<td>Sub-Payload 0</td><td>Sub-Payload 1</td><td>Sub-Payload 2</td><td>...</td><td>Sub-Payload N-1 </td></tr>
</table>
</dd></dl>
<p><br />
</p>
<h3><a class="anchor" id="enStructureOfSubPayloads"></a>
Structure Of Sub-Payloads</h3>
<dl class="section user"><dt></dt><dd>Sub-payload can be divided into three parts; Header, Length and Data.</dd></dl>
<dl class="section user"><dt></dt><dd><table class="doxtable">
<tr align="center">
<th>Name</th><td>Header</td><td>Length</td><td>Data </td></tr>
<tr align="center">
<th>Size</th><td>1 Byte</td><td>1 Byte</td><td>N Byte(s) </td></tr>
<tr align="center">
<th align="center">Description</th><td width="100">Predefined Identifier</td><td width="100">Size of data in byte(s)</td><td width="100">Described below </td></tr>
</table>
</dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enChecksum"></a>
Checksum</h2>
<p>Checksum is XOR'ed value of entire bytestream except headers. Checksum process ensure the integrity of bytestreams.</p>
<p>Here is simple code snippet for it. </p><div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> packet_size(buffer.size());</div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cs(0);</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 2; i &lt; packet_size; i++)</div><div class="line">{</div><div class="line">  cs ^= buffer[i];</div><div class="line">}</div><div class="line"><span class="keywordflow">return</span> cs ? <span class="keyword">false</span> : <span class="keyword">true</span>;</div></div><!-- fragment --><p><br />
</p>
<h2><a class="anchor" id="enEntireBytestream"></a>
Entire Bytestream</h2>
<table class="doxtable">
<tr align="center">
<td colspan="2">Headers</td><td rowspan="2">Length</td><td colspan="5">Payload</td><td rowspan="2">Checksum </td></tr>
<tr align="center">
<td>Header 0</td><td>Header 1</td><td>Sub-Payload 0</td><td>Sub-Payload 1</td><td>Sub-Payload 2</td><td>...</td><td>Sub-Payload N-1 </td></tr>
</table>
<p>Above table shows the structure of entire bytestream.</p>
<p>Minimum length of payload is 3; Payload with a sub-payload, that has only 1 byte data.</p>
<p>Theoretical minimum length of entire packet(bytestream) is 7.</p>
<p><br />
</p>
<h1><a class="anchor" id="enDataTypes"></a>
Data Types</h1>
<p>Data field in Sub-payload is a mixture of below three data types; byte, short and int. </p><table class="doxtable">
<tr align="center">
<th>Name</th><th>Description</th><th>Byte Length</th><th>Bit Length</th><th>Data Range</th><th colspan="2">C/C++ Identifier </th></tr>
<tr align="center">
<td>Unsigned Byte</td><td>8-bit unsigned integer</td><td>1</td><td>8</td><td>0~255</td><td>unsigned char</td><td>uint8_t </td></tr>
<tr align="center">
<td>Unsigned Short</td><td>16-bit unsigned integer</td><td>2</td><td>16</td><td>0~65,535</td><td>unsigned short</td><td>uint16_t </td></tr>
<tr align="center">
<td>Unsigned Int</td><td>32-bit unsigned integer</td><td>4</td><td>32</td><td>0~4,294,967,295</td><td>unsigned int</td><td>uint32_t  </td></tr>
</table>
<p><br />
</p>
<h2><a class="anchor" id="enSerializationDerialization"></a>
Serialization-Deserialization</h2>
<p><a href="http://en.wikipedia.org/wiki/Serialization">Serialization</a> is the process of converting a data structure into a bytestream. Deserialization is reversal process. Each data types are serialized and deserialized by <code>&lt;a href="http://en.wikipedia.org/wiki/Least_significant_byte"&gt;LSB&lt;/a&gt;-First Order</code>. It means Least Significant Bytes will comes first on the bytestream. For example, The integer number 2,864,434,397(0xAABBCCDD) can be serialized into: </p><table class="doxtable">
<tr>
<td>0xDD</td><td>0xCC</td><td>0xBB</td><td>0xAA </td></tr>
</table>
<p>So, 0xDD will arrive first in bytestream.</p>
<p>Here are template functions to handle it on kobuki_deriver, <a class="el" href="classpacket__handler_1_1payloadBase.html#a367c89d2f4ed8a587956f99e62cf865a">buildVariable()</a> and <a class="el" href="classpacket__handler_1_1payloadBase.html#ab614ccfc29826da5758ae165cb7eabf6">buildBytes()</a>.</p>
<p><br />
</p>
<h1><a class="anchor" id="enCommandPackets"></a>
Command Packets</h1>
<h2><a class="anchor" id="enCommandIdentifier"></a>
Command Identifier</h2>
<table class="doxtable">
<tr>
<th>ID</th><th>Name</th><th>Description </th></tr>
<tr>
<td align="center">1</td><td>Base Control</td><td>Control wheel motors </td></tr>
<tr>
<td align="center">2</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">3</td><td>Sound</td><td>Play custom sounds </td></tr>
<tr>
<td align="center">4</td><td>Sound Sequence</td><td>Play predefined sounds </td></tr>
<tr>
<td align="center">5</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">6</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">7</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">8</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">9</td><td>Request Extra</td><td>Request extra informations </td></tr>
<tr>
<td align="center">10</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">11</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">12</td><td>General Purpose Output</td><td>Control general purpose outputs </td></tr>
<tr>
<td align="center">13</td><td>Set Controller Gain</td><td>Set PID gain of wheel velocity controller </td></tr>
<tr>
<td align="center">14</td><td>Get Controller Gain</td><td>Request current PID gain of wheel velocity controller </td></tr>
</table>
<p><br />
</p>
<h2><a class="anchor" id="enBaseControl"></a>
Base Control</h2>
<p>Control wheel motors to moving robot. Robot will follow the arc line, which radius is <b>&lt;Radius&gt;</b> mm, with <b>&lt;Speed&gt;</b> mm/s. Positive Radius indicates center of arc line that robot follows is located at the left side of the robot. Negative is opposite.<br />
</p>
<div class="image">
<img src="velocity_representation.png" alt="velocity_representation.png"/>
<div class="caption">
Velocity Representation</div></div>
<p> But actual value of Speed field is little bit different. Here is conversion table.</p>
<table class="doxtable">
<tr>
<th>Motion</th><th>Speed(mm/s)</th><th>Radius(mm) </th></tr>
<tr>
<td>Pure Translation</td><td>Speed</td><td>0 </td></tr>
<tr>
<td>Pure Rotation</td><td>w<b><sup>i)</sup></b> * b<b><sup>ii)</sup></b> / 2</td><td>1 </td></tr>
<tr>
<td rowspan="2">Translation + Rotation</td><td>Speed * ( Radius + b<b><sup>ii)</sup></b> / 2 ) / Radius, if Radius &gt; 1<br />
Speed * ( Radius - b<b><sup>ii)</sup></b> / 2 ) / Radius, if Radius &lt; -1</td><td>Radius </td></tr>
</table>
<p><b>i)</b> w is rotation speed of the robot, in [rad/s].<br />
 <b>ii)</b> b is <em>bias</em> or <em>wheelbase</em>, that indicates the length between the center of the wheels. Fixed at 230 mm.<br />
 <br />
</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">1</td><td>0x01</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">4</td><td>0x04</td><td>Fixed </td></tr>
<tr>
<th rowspan="2">Data</th><td>Speed</td><td align="center">2</td><td align="center"></td><td></td><td>in mm/s </td></tr>
<tr>
<td>Radius</td><td align="center">2</td><td align="center"></td><td></td><td>in mm </td></tr>
</table>
<p><br />
</p>
<h2><a class="anchor" id="enSound"></a>
Sound</h2>
<p>Play custom sounds with note and duration.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">3</td><td>0x03</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">3</td><td>0x03</td><td>Fixed </td></tr>
<tr>
<th rowspan="2">Data</th><td>Note</td><td align="center">2</td><td align="center"></td><td></td><td><img class="formulaInl" alt="$\mbox{1/}(f \cdotp a)$" src="form_0.png"/>, where <img class="formulaInl" alt="$f$" src="form_1.png"/> is frequency of sound in Hz, and <img class="formulaInl" alt="$a$" src="form_2.png"/> is 0.00000275 </td></tr>
<tr>
<td>Duration</td><td align="center">1</td><td align="center"></td><td></td><td>Duration of playing note in milli-seconds </td></tr>
</table>
<dl class="section warning"><dt>Warning</dt><dd>This command is implemented on the kobuki with firmware, but not implemented yet on driver software(kobuki_driver).</dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enSoundSequence"></a>
Sound Sequence</h2>
<p>Play predefined sounds by its index.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">4</td><td>0x04</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">1</td><td>0x01</td><td>Fixed </td></tr>
<tr>
<th>Data</th><td>Sequence number</td><td align="center">1</td><td align="center"></td><td></td><td>0 for ON sound<br />
1 for OFF sound<br />
2 for RECHARGE sound<br />
3 for BUTTON sound<br />
4 for ERROR sound<br />
5 for CLEANINGSTART sound<br />
6 for CLEANINGEND sound </td></tr>
</table>
<p><br />
</p>
<h2><a class="anchor" id="enRequestExtra"></a>
Request Extra</h2>
<p>Request extra data from robot. Especially version info of kobuki; Hardware Version, Firmware Version and Unique Device IDentifier(UDID)</p>
<p>UDID is unique to device. so can be used to identify on multiple robots.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">9</td><td>0x09</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">2</td><td>0x02</td><td>Fixed </td></tr>
<tr>
<th>Data</th><td>Request flags</td><td align="center">2</td><td align="center"></td><td></td><td>Set the flags to request extra data<br />
0x01 for Hardware Version<br />
0x02 for Firmware Version<br />
0x08 for Unique Device ID </td></tr>
</table>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="enAppendixProtocolSpecification.html#enHardwareVersion">Hardware Version</a>, <a class="el" href="enAppendixProtocolSpecification.html#enFirmwareVersion">Firmware Version</a>, <a class="el" href="enAppendixProtocolSpecification.html#enUniqueDeviceIDentifier">Unique Device IDentifier(UDID)</a></dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enGeneralPurposeOutput"></a>
General Purpose Output</h2>
<p>This command has multiple roles. It controls LEDs, digital outputs and external powers.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">12</td><td>0x0C</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">2</td><td>0x02</td><td>Fixed </td></tr>
<tr>
<th>Data</th><td>Digital output flags</td><td align="center">2</td><td align="center"></td><td></td><td>Set the flags to set high on output pins of expansion port<br />
0x0001 for digital output ch. 0<br />
0x0002 for digital output ch. 1<br />
0x0004 for digital output ch. 2<br />
0x0008 for digital output ch. 3<br />
<br />
Set the flags to turn on external powers<br />
0x0010 for external power 3.3V ch.<br />
0x0020 for external power 5V ch.<br />
0x0040 for external power 12V/5A ch.<br />
0x0080 for external power 12V/1.5A ch.<br />
<br />
Set the flags to turn on LEDs<br />
0x0100 for red colour of LED1<br />
0x0200 for green colour of LED1<br />
0x0400 for red colour of LED2<br />
0x0800 for green colour of LED2<br />
 </td></tr>
</table>
<p><br />
</p>
<h2><a class="anchor" id="enSetControllerGain"></a>
Set Controller Gain</h2>
<p>Set PID gain of wheel velocity controller of robot.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">1</td><td>0x01</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">13</td><td>0x0D</td><td>Fixed </td></tr>
<tr>
<th rowspan="4">Data</th><td>Type</td><td align="center">1</td><td align="center"></td><td></td><td>0 for factory-default PID gain<br />
1 for user-configured PID gain </td></tr>
<tr>
<td>P gain</td><td align="center">4</td><td align="center"></td><td></td><td>Kp * 1000 (default: 100*1000) </td></tr>
<tr>
<td>I gain</td><td align="center">4</td><td align="center"></td><td></td><td>Ki * 1000 (default: 0.1*1000) </td></tr>
<tr>
<td>D gain</td><td align="center">4</td><td align="center"></td><td></td><td>Kd * 1000 (default: 2*1000) </td></tr>
</table>
<p><br />
</p>
<h2><a class="anchor" id="enGetControllerGain"></a>
Get Controller Gain</h2>
<p>Request PID gain of wheel velocity controller of robot.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">1</td><td>0x01</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">14</td><td>0x0E</td><td>Fixed </td></tr>
<tr>
<th>Data</th><td>unused</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
</table>
<p><br />
</p>
<h1><a class="anchor" id="enFeedbackPackets"></a>
Feedback Packets</h1>
<h2><a class="anchor" id="enFeedbackIdentifier"></a>
Feedback Identifier</h2>
<p>Kobuki sends below default feedbacks periodically in 50 Hz, when it powered on.</p>
<table class="doxtable">
<tr>
<th>ID</th><th>Name</th><th>Description</th><th>Availability </th></tr>
<tr>
<td align="center">1</td><td>Basic Sensor Data</td><td>Basic core sensor data</td><td>By default </td></tr>
<tr>
<td align="center">2</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">3</td><td>Docking IR</td><td>Signals from docking station</td><td>By default </td></tr>
<tr>
<td align="center">4</td><td>Inertial Sensor</td><td>Gyro data both angle and angular velocity</td><td>By default </td></tr>
<tr>
<td align="center">5</td><td>Cliff</td><td>PSD data facing floor</td><td>By default </td></tr>
<tr>
<td align="center">6</td><td>Current</td><td>Current of wheel motors</td><td>By default </td></tr>
<tr>
<td align="center">7</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">8</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">9</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">10</td><td>Hardware Version</td><td>Version number of kobuki hardware</td><td>On request </td></tr>
<tr>
<td align="center">11</td><td>Firmware Version</td><td>Version number of kobuki firmware</td><td>On request </td></tr>
<tr>
<td align="center">12</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">13</td><td>Raw data of 3-axis gyro</td><td>Raw ADC data of digital 3-axis gyro</td><td>By default </td></tr>
<tr>
<td align="center">14</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">15</td><td>Reserved</td><td></td><td></td></tr>
<tr>
<td align="center">16</td><td>General Purpose Input</td><td>Inputs from 25-pin expansion port</td><td>By default </td></tr>
<tr>
<td align="center">17</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">18</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">19</td><td>Unique Device IDentifier(UDID)</td><td>Unique number to identify robot</td><td>On request </td></tr>
<tr>
<td align="center">20</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">21</td><td>Controller Info</td><td>PID gain values of wheel velocity controller.</td><td>On request </td></tr>
</table>
<p><br />
</p>
<h2><a class="anchor" id="enBasicSensorData"></a>
Basic Sensor Data</h2>
<p>Basic core sensor data.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Feedback Identifier</td><td align="center">1</td><td align="center">1</td><td>0x01</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">15</td><td>0x0F</td><td>Fixed </td></tr>
<tr>
<th rowspan="12">Data</th><td>Timestamp</td><td align="center">2</td><td align="center"></td><td></td><td>Timestamp generated internally in milliseconds<br />
It circulates from 0 to 65535 </td></tr>
<tr>
<td>Bumper</td><td align="center">1</td><td align="center"></td><td></td><td>Flag will be setted when bumper is pressed<br />
0x01 for right bumper<br />
0x02 for central bumper<br />
0x04 for left bumper </td></tr>
<tr>
<td>Wheel drop</td><td align="center">1</td><td align="center"></td><td></td><td>Flag will be setted when wheel is dropped<br />
0x01 for right wheel<br />
0x02 for left wheel </td></tr>
<tr>
<td>Cliff</td><td align="center">1</td><td align="center"></td><td></td><td>Flag will be setted when cliff is detected<br />
0x01 for right cliff sensor<br />
0x02 for central cliff sensor<br />
0x04 for left cliff sensor </td></tr>
<tr height="30">
<td>Left encoder</td><td align="center">2</td><td align="center"></td><td></td><td rowspan="2">Accumulated encoder data of left and right wheels in ticks<br />
Increments of this value means forward direction<br />
It circulates from 0 to 65535 </td></tr>
<tr height="30">
<td>Right encoder</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr height="30">
<td>Left PWM</td><td align="center">1</td><td align="center"></td><td></td><td rowspan="2">PWM value that applied to left and right wheel motor<br />
This data should be converted signed type to represent correctly<br />
Negative sign indicates backward direction </td></tr>
<tr height="30">
<td>Right PWM</td><td align="center">1</td><td align="center"></td><td></td></tr>
<tr>
<td>Button</td><td align="center">1</td><td align="center"></td><td></td><td>Flag will be setted when button is pressed<br />
0x01 for Button 0<br />
0x02 for Button 1<br />
0x04 for Button 2 </td></tr>
<tr>
<td>Charger</td><td align="center">1</td><td align="center"></td><td></td><td>0 for DISCHARGING state<br />
2 for DOCKING_CHARGED state<br />
6 for DOCKING_CHARGING state<br />
18 for ADAPTER_CHARGED state<br />
22 for ADAPTER_CHARGING state </td></tr>
<tr>
<td>Battery</td><td align="center">1</td><td align="center"></td><td></td><td>Voltage of battery in 0.1 V<br />
Typically 16.7 V when fully charged </td></tr>
<tr>
<td>Overcurrent flags</td><td align="center">1</td><td align="center"></td><td></td><td>Flag will be setted when overcurrent is detected<br />
0x01 for left wheel<br />
0x02 for right wheel </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>This sub-payload will be sent by default. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="enAppendixKobukiParameters.html">Appendix : Kobuki Parameters</a> - necessary parameters for conversion of encoder ticks to robot pose.</dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enDockingIR"></a>
Docking IR</h2>
<p>Signals from the docking station.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">3</td><td>0x03</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">3</td><td>0x03</td><td>Fixed </td></tr>
<tr height="40">
<th rowspan="3">Data</th><td>Right signal</td><td align="center">1</td><td align="center"></td><td></td><td rowspan="3">Flag will be setted when signal is detected<br />
0x01 for NEAR_LEFT state<br />
0x02 for NEAR_CENTER state<br />
0x04 for NEAR_RIGHT state<br />
0x08 for FAR_CENTER state<br />
ox10 for FAR_LEFT state<br />
0x20 for FAR_RIGHT state </td></tr>
<tr height="40">
<td>Central signal</td><td align="center">1</td><td align="center"></td><td></td></tr>
<tr height="40">
<td>Left signal</td><td align="center">1</td><td align="center"></td><td></td></tr>
</table>
<p>Kobuki's docking station has 3 <a href="http://en.wikipedia.org/wiki/Infrared">IR</a> emitters. The emitted IR lights cover three regions in front of the docking station: left, central and right, each divided in two sub-fields: near and far. Each beam encodes this information, so the robot knows at any moment in which region and sub-field he is. Also, as regions and fields are independently identified, they can be overlap on its borders. </p><div class="image">
<img src="dock_ir_fields.png" alt="dock_ir_fields.png"/>
<div class="caption">
Docking IR Fields</div></div>
<p> <br />
</p>
<h2><a class="anchor" id="enInertialSensorData"></a>
Inertial Sensor Data</h2>
<p>Inertial sensor data. Z-axis gyro data only available.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">4</td><td>0x04</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">7</td><td>0x07</td><td>Fixed </td></tr>
<tr>
<th rowspan="5">Data</th><td>Angle</td><td align="center">2</td><td align="center"></td><td></td><td>Factory calibrated </td></tr>
<tr>
<td>Angle rate</td><td align="center">2</td><td align="center"></td><td></td><td>Factory calibrated </td></tr>
<tr>
<td>Unused</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>This sub-payload will be sent by default.</dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enCliffSensorData"></a>
Cliff Sensor Data</h2>
<p>This sub-payload provides <a href="http://en.wikipedia.org/wiki/Analog-to-digital_converter">ADC</a> data of <a href="http://en.wikipedia.org/wiki/Position_sensitive_device">PSD</a> sensor, which is facing the floor.</p>
<p>This value is related with distance between sensor and floor surface. See the <a href="http://www.beck-elektronik.de/fileadmin/templates/beck_folder/opto/sensor/sharp/analog-gp2y0a51sk0f.pdf">datasheet</a> for more detailed information.</p>
<p>This data also available in the Cliff field of <a class="el" href="enAppendixProtocolSpecification.html#enBasicSensorData">Basic Sensor Data</a> , as a boolean type, processed on the kobuki.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">5</td><td>0x05</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">6</td><td>0x06</td><td>Fixed </td></tr>
<tr>
<th rowspan="3">Data</th><td>Right cliff sensor</td><td align="center">2</td><td align="center"></td><td></td><td rowspan="3">ADC output of each PSD<br />
Data range: 0 ~ 4095 (0 ~ 3.3V)<br />
Distance range: 2 ~ 15 cm<br />
Distance is not linear w.r.t. ADC output.<br />
See the <a href="http://www.beck-elektronik.de/fileadmin/templates/beck_folder/opto/sensor/sharp/analog-gp2y0a51sk0f.pdf">datasheet</a> for more detail. </td></tr>
<tr>
<td>Central cliff sensor</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>Left cliff sensor</td><td align="center">2</td><td align="center"></td><td></td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>This sub-payload will be sent by default.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="enAppendixProtocolSpecification.html#enBasicSensorData">Basic Sensor Data</a></dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enCurrent"></a>
Current</h2>
<p>Current sensor readings of wheel motors.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">6</td><td>0x06</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">2</td><td>0x02</td><td>Fixed </td></tr>
<tr>
<th rowspan="2">Data</th><td>Left motor</td><td align="center">2</td><td align="center"></td><td></td><td>in 10mA </td></tr>
<tr>
<td>Right motor</td><td align="center">2</td><td align="center"></td><td></td><td>in 10mA </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>This sub-payload will be sent by default.</dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enHardwareVersion"></a>
Hardware Version</h2>
<p>Hardware version info in triplet form; &lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">10</td><td>0x0A</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">4</td><td>0x04</td><td>Fixed </td></tr>
<tr>
<th rowspan="4">Data</th><td>Patch</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Minor</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Major</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">1</td><td align="center">0</td><td>0x00</td><td>Fixed </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>This sub-payload will be sent on request. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="enAppendixProtocolSpecification.html#enRequestExtra">Request Extra</a></dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enFirmwareVersion"></a>
Firmware Version</h2>
<p>Firmware version info in triplet form; &lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">11</td><td>0x0B</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">4</td><td>0x04</td><td>Fixed </td></tr>
<tr>
<th rowspan="4">Data</th><td>Patch</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Minor</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Major</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">1</td><td align="center">0</td><td>0x00</td><td>Fixed </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>This sub-payload will be sent on request. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="enAppendixProtocolSpecification.html#enRequestExtra">Request Extra</a></dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enRawDataOf3DGyro"></a>
Raw Data Of 3D Gyro</h2>
<p>Raw ADC data of digital 3D gyro; <a href="http://www.st.com/internet/analog/product/250373.jsp">L3G4200D</a></p>
<p>Due to difference of acquisition rate and update rate, 2-3 data will be arrived at once.</p>
<p>Digit to deg/s ratio is 0.00875, it comes from <a href="http://www.st.com/internet/com/TECHNICAL_RESOURCES/TECHNICAL_LITERATURE/DATASHEET/CD00265057.pdf">datasheet</a> of 3d gyro.</p>
<table class="doxtable">
<tr>
<th></th><th colspan="2">Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td colspan="2">Identifier</td><td align="center">1</td><td align="center">13</td><td>0x0D</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td colspan="2">Size of data field</td><td align="center">1</td><td align="center">2+6N</td><td></td><td></td></tr>
<tr>
<th rowspan="9">Data</th><td colspan="2">Frame id</td><td align="center">1</td><td align="center"></td><td></td><td>Frame id of 'Raw gyro data 0'<br />
Every sensor readings can identified by frame id<br />
, It circulate from 0 to 255 </td></tr>
<tr>
<td colspan="2">Followed data length</td><td align="center">1</td><td align="center">3N</td><td></td><td></td></tr>
<tr>
<td rowspan="3">Raw gyro data 0</td><td>x-axis</td><td align="center">2</td><td align="center"></td><td></td><td rowspan="7">ADC output of each-axis in 0.00875 deg/s </td></tr>
<tr>
<td>y-axis</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>z-axis</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td colspan="5" align="center">:<br />
: </td></tr>
<tr>
<td rowspan="3">Raw gyro data N-1</td><td>x-axis</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>y-axis</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>z-axis</td><td align="center">2</td><td align="center"></td><td></td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>This sub-payload will be sent by default.</dd></dl>
<p><br />
</p>
<dl class="section warning"><dt>Warning</dt><dd>Sensing axis of 3d gyro is not match with robot. It is rotated 90 degree counterclockwise about z-axis. So, below conversion will needed. <div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> digit_to_dps = 0.00875;</div><div class="line">angular_velocity.x =  -digit_to_dps * (short)raw_gyro_data.y;</div><div class="line">angular_velocity.y =   digit_to_dps * (<span class="keywordtype">short</span>)raw_gyro_data.x;</div><div class="line">angular_velocity.z =   digit_to_dps * (short)raw_gyro_data.z;</div></div><!-- fragment --></dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enGeneralPurposeInput"></a>
General Purpose Input</h2>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">16</td><td>0x10</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">16</td><td>0x10</td><td>Fixed </td></tr>
<tr>
<th rowspan="8">Data</th><td>Digital input</td><td align="center">2</td><td align="center"></td><td></td><td>Flag will be setted, when high voltage is applied<br />
0x01 for digital input ch. 0<br />
0x02 for digital input ch. 1<br />
0x04 for digital input ch. 2<br />
0x08 for input output ch. 3 </td></tr>
<tr>
<td>Analog input ch.0</td><td align="center">2</td><td align="center"></td><td></td><td rowspan="4">12-bit ADC output of each channel<br />
Data range: 0 ~ 4095(2^12-1)<br />
Voltage range: 0 ~ 3.3 V </td></tr>
<tr>
<td>Analog input ch.1</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>Analog input ch.2</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>Analog input ch.3</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">2</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">2</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">2</td><td align="center"></td><td></td><td></td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>This sub-payload will be sent by default.</dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enUniqueDeviceIDentifier"></a>
Unique Device IDentifier(UDID)</h2>
<p>Contains Unique Device IDentifier of robot. This value is unique for all robot in the world. It can be represented by triplet form: &lt;UDID0&gt;-&lt;UDID1&gt;-&lt;UDID2&gt;</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">19</td><td>0x13</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">12</td><td>0x0C</td><td>Fixed </td></tr>
<tr>
<th rowspan="4">Data</th><td>UDID0</td><td align="center">4</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>UDID1</td><td align="center">4</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>UDID2</td><td align="center">4</td><td align="center"></td><td></td><td></td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>This sub-payload will be sent on request. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="enAppendixProtocolSpecification.html#enRequestExtra">Request Extra</a></dd></dl>
<p><br />
</p>
<h2><a class="anchor" id="enControllerInfo"></a>
Controller Info</h2>
<p>Contains PID gain of wheel velocity controller of robot.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">1</td><td>0x01</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">21</td><td>0x15</td><td>Fixed </td></tr>
<tr>
<th rowspan="4">Data</th><td>Type</td><td align="center">1</td><td align="center"></td><td></td><td>Current controller setup<br />
0 for factory-default PID gain<br />
1 for user-configured PID gain </td></tr>
<tr>
<td>P gain</td><td align="center">4</td><td align="center"></td><td></td><td>Kp * 1000 (default: 100*1000) </td></tr>
<tr>
<td>I gain</td><td align="center">4</td><td align="center"></td><td></td><td>Ki * 1000 (default: 0.1*1000) </td></tr>
<tr>
<td>D gain</td><td align="center">4</td><td align="center"></td><td></td><td>Kd * 1000 (default: 2*1000) </td></tr>
</table>
<p><br />
 </p>
</div></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/kobuki_driver">kobuki_driver</a><br />
Author(s): Daniel Stonier <stonier@yujinrobot.com>, Younghun Ju <yhju@yujinrobot.com>, Jorge Santos Simon <jorge@yujinrobot.com></br />
<small>autogenerated on Mon Mar 27 2017 01:02:59</small>
</div>
</body>
</html>
