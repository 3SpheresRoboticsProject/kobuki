<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>kobuki_driver: Getting Started</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="kobukiClass"></a>
Overview</h1>
<p>The <a class="el" href="classkobuki_1_1Kobuki.html">kobuki::Kobuki</a> class is the first port of call for developing your kobuki program. All kobuki configuration and interaction is done via this class. This guide will cover configuration and interaction with the library method api. Interactions via callbacks using sigslots is covered especially in the guide on <a class="el" href="enSigslotsGuide.html">sigslots</a>.</p>
<h1><a class="anchor" id="kobukiConfiguration"></a>
Configuration</h1>
<p>Kobuki configuration is handled by the <a class="el" href="classkobuki_1_1Parameters.html">kobuki::Parameters</a> class which is passed to the kobuki instance via the <a class="el" href="classkobuki_1_1Kobuki.html#a0648c958434e641d4573721541099ee4">kobuki::Kobuki::init()</a> method. Most of the parameters to be configured have sane defaults. The only one that requires frequent configuration is typically the serial <a class="el" href="classkobuki_1_1Parameters.html#a993217236ea68f063f5bc285414408e2">device_port</a>. Note that on some systems you can configure a rule (refer to the <a class="el" href="enFtdiGuide.html">ftdi serial device guide</a>) for the device port, otherwise you will require one of the usual COM1 or /dev/ttyUSB0 values.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kobuki_8hpp.html">kobuki_driver/kobuki.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ecl/time.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="classKobukiManager.html">KobukiManager</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <a class="code" href="classKobukiManager.html#af719c61bfe21c8c3e35320edba20f7aa">KobukiManager</a>() {</div><div class="line">    <a class="code" href="classkobuki_1_1Parameters.html">kobuki::Parameters</a> parameters;</div><div class="line">    <span class="comment">// change the default device port from /dev/kobuki to /dev/ttyUSB0</span></div><div class="line">    parameters.<a class="code" href="classkobuki_1_1Parameters.html#a993217236ea68f063f5bc285414408e2">device_port</a> = <span class="stringliteral">&quot;/dev/ttyUSB0&quot;</span>;</div><div class="line">    <span class="comment">// Other parameters are typically happy enough as defaults</span></div><div class="line">    <span class="comment">// namespaces all sigslot connection names under this value, only important if you want to</span></div><div class="line">    parameters.<a class="code" href="classkobuki_1_1Parameters.html#a0717933338e84bc7907f7e8345e2347e">sigslots_namespace</a> = <span class="stringliteral">&quot;/kobuki&quot;</span>;</div><div class="line">    <span class="comment">// Most people will prefer to do their own velocity smoothing/acceleration limiting.</span></div><div class="line">    <span class="comment">// If you wish to utilise kobuki&#39;s minimal acceleration limiter, set to true</span></div><div class="line">    parameters.<a class="code" href="classkobuki_1_1Parameters.html#ab6eaa092677b34a152c9a11dfd3ff56f">enable_acceleration_limiter</a> = <span class="keyword">false</span>;</div><div class="line">    <span class="comment">// If your battery levels are showing significant variance from factory defaults, adjust thresholds.</span></div><div class="line">    <span class="comment">// This will affect the led on the front of the robot as well as when signals are emitted by the driver.</span></div><div class="line">    parameters.<a class="code" href="classkobuki_1_1Parameters.html#a0c7b04175141d702f520c4a963876143">battery_capacity</a> = 16.5;</div><div class="line">    parameters.<a class="code" href="classkobuki_1_1Parameters.html#afbe3833926add7263db592c6b0116b36">battery_low</a> = 14.0;</div><div class="line">    parameters.<a class="code" href="classkobuki_1_1Parameters.html#a6332cc2748b6f7095e1eb463a024289d">battery_dangerous</a> = 13.2;</div><div class="line"></div><div class="line">    <span class="comment">// initialise - it will throw an exception if parameter validation or initialisation fails.</span></div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">      <a class="code" href="namespacekobuki.html">kobuki</a>.init(parameters);</div><div class="line">    } <span class="keywordflow">catch</span> ( ecl::StandardException &amp;e ) {</div><div class="line">      std::cout &lt;&lt; e.what();</div><div class="line">    }</div><div class="line">  }</div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <a class="code" href="classkobuki_1_1Kobuki.html">kobuki::Kobuki</a> <a class="code" href="classKobukiManager.html#aedbd8a41454f86c36938b15481688d4c">kobuki</a>;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="initialisation_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div><div class="line">  <a class="code" href="classKobukiManager.html">KobukiManager</a> kobuki_manager;</div><div class="line">  ecl::Sleep()(5);</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>If you compile and run this program, you should hear kobuki's starting up chirp followed immediately by the shutting down chirp.</p>
<h1><a class="anchor" id="kobukiLibraryApi"></a>
Library Api</h1>
<h2><a class="anchor" id="kobukiRawData"></a>
Raw Data</h2>
<p>The kobuki driver runs a background thread which continually retrieves packets from the kobuki, saving the raw data, and additionally doing some processing before updating the current state of the robot.</p>
<p>Raw data can be accessed at any time by one of the following getXXX commands:</p>
<ul>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a33ff3a81a9a43c025da6efb21dc0ac9b">kobuki::Kobuki::getCoreSensorData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a8af97d7fdc4bd55f1172e5b9b421f343">kobuki::Kobuki::getDockIRData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a75ed69becc3058d2a9525cfbe81aabe1">kobuki::Kobuki::getCliffData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a7e32d9b2879ed4fa50a233bb4fed8413">kobuki::Kobuki::getCurrentData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a2ab9631196aa4211b9b6b1634ab9b5f5">kobuki::Kobuki::getGpInputData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a7dd63be4984cc95c72aa2fa9dcd0f9d1">kobuki::Kobuki::getInertiaData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#ae3d74aafb393b426069b196e04b09574">kobuki::Kobuki::getRawInertiaData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a3d9d8cd87fd98bce6adda4f3e9530b41">kobuki::Kobuki::getControllerInfoData</a></li>
</ul>
<p>The gyro provides both filtered yaw angle as well as unfiltered 3-axis inertial data hence the two calls above.</p>
<h2><a class="anchor" id="kobukiProcessedData"></a>
Processed Data and Status</h2>
<p>The following are convenience methods for accessing the current state of the robot</p>
<ul>
<li><a class="el" href="classkobuki_1_1Kobuki.html#ada9c8b518d41ceaf9326de577eec2d2b">kobuki::Kobuki::batteryStatus</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#af72c123e33ca1882f25800c9af5fb717">kobuki::Kobuki::getHeading</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a2a64a16a6c4b587627f5a304359ec641">kobuki::Kobuki::getAngularVelocity</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a2b45e19fa61a2c542dcae5a7973dd28f">kobuki::Kobuki::versionInfo</a> : hardware, firmware and software version strings.</li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a70e163fcf282a169a1c1c7cbb8564294">kobuki::Kobuki::getWheelJointStates</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a395e07e7e4c32117471c4ec8459b73c5">kobuki::Kobuki::isAlive</a> : true if a kobuki is detected and streaming data.</li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a3c250f1d287ebe46c4711307c1d99d59">kobuki::Kobuki::isEnabled</a> : true if the motor power is enabled</li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a96f16e56b7483d3dad75b63ce10f91a5">kobuki::Kobuki::isShutdown</a> : true if the worker threads for this driver have been shut down.</li>
</ul>
<h2><a class="anchor" id="kobukiSoftCommands"></a>
Soft Commands</h2>
<ul>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a9a8e7a0dfa5c9fd447d2791217ca1bca">kobuki::Kobuki::resetOdometry</a></li>
</ul>
<h2><a class="anchor" id="kobukiHardCommands"></a>
Hard Commands</h2>
<ul>
<li><a class="el" href="classkobuki_1_1Kobuki.html#af016306e3114daf0c61ffbaae0b3d1a0">kobuki::Kobuki::setBaseControl</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#acfa8adb823fe03d7223d41a13d8e66cf">kobuki::Kobuki::setLed</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a188d1db38aa059f96e3bfb0879b244f8">kobuki::Kobuki::setDigitalOutput</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a53a52a4a94507afe3ce30a0f6dfbefdf">kobuki::Kobuki::setExternalPower</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#afaf3bd9ab3e781fec84200041ed95f30">kobuki::Kobuki::playSoundSequence</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a823260e89ce7e35fe1c721e3be1ec832">kobuki::Kobuki::setControllerGain</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#acdc18337219b79cf202c3b4178ff62fa">kobuki::Kobuki::getControllerGain</a></li>
</ul>
<h2><a class="anchor" id="differentialDriverModule"></a>
The Differential Drive Module</h2>
<p>The final function of importance is the <a class="el" href="classkobuki_1_1Kobuki.html#a20913af66616fd0242e38f9ab11228c6">kobuki::Kobuki::updateOdometry</a> method. This updates the current odometry state of the robot, fusing encoder and gyro heading data with the previous known state. For deterministic odometry, it is important this method is called each time a new data packet from the kobuki arrives. Refer to the <a class="el" href="enSimpleExample.html">simple control loop example</a> for more information and working code to illustrate. </p>
</div></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/kobuki_driver">kobuki_driver</a><br />
Author(s): Daniel Stonier <stonier@yujinrobot.com>, Younghun Ju <yhju@yujinrobot.com>, Jorge Santos Simon <jorge@yujinrobot.com></br />
<small>autogenerated on Mon Mar 27 2017 01:02:59</small>
</div>
</body>
</html>
