<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>kobuki_driver: Getting Started</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="kobukiClass"></a>
Overview</h2>
<p>The <a class="el" href="classkobuki_1_1Kobuki.html">kobuki::Kobuki</a> class is the first port of call for developing your kobuki program. All kobuki configuration and interaction is done via this class. This guide will cover configuration and interaction with the library method api. Interactions via callbacks using sigslots is covered especially in the guide on <a class="el" href="enSigslotsGuide.html">sigslots</a>.</p>
<h2><a class="anchor" id="kobukiConfiguration"></a>
Configuration</h2>
<p>Kobuki configuration is handled by the <a class="el" href="classkobuki_1_1Parameters.html">kobuki::Parameters</a> class which is passed to the kobuki instance via the <a class="el" href="classkobuki_1_1Kobuki.html#a0648c958434e641d4573721541099ee4">kobuki::Kobuki::init()</a> method. Most of the parameters to be configured have sane defaults. The only one that requires frequent configuration is typically the serial <a class="el" href="classkobuki_1_1Parameters.html#a993217236ea68f063f5bc285414408e2">device_port</a>. Note that on some systems you can configure a rule (refer to the <a class="el" href="enFtdiGuide.html">ftdi serial device guide</a>) for the device port, otherwise you will require one of the usual COM1 or /dev/ttyUSB0 values.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="kobuki_8hpp.html" title="Device driver core interface.">kobuki_driver/kobuki.hpp</a>&gt;</span>

<span class="keyword">class </span><a class="code" href="classKobukiManager.html">KobukiManager</a> {
<span class="keyword">public</span>:
  <a class="code" href="classKobukiManager.html#af719c61bfe21c8c3e35320edba20f7aa">KobukiManager</a>() {
    <a class="code" href="classkobuki_1_1Parameters.html" title="Parameter list and validator for the kobuki.">kobuki::Parameters</a> parameters;
    <span class="comment">// change the default device port from /dev/kobuki to /dev/ttyUSB0</span>
    parameters.<a class="code" href="classkobuki_1_1Parameters.html#a993217236ea68f063f5bc285414408e2" title="The serial device port name [/dev/kobuki].">device_port</a> = <span class="stringliteral">&quot;/dev/ttyUSB0&quot;</span>;
    <span class="comment">// Other parameters are typically happy enough as defaults</span>
    <span class="comment">// namespaces all sigslot connection names under this value, only important if you want to </span>
    parameters.<a class="code" href="classkobuki_1_1Parameters.html#a0717933338e84bc7907f7e8345e2347e" title="The first part of a sigslot connection namespace [&quot;/kobuki&quot;].">sigslots_namespace</a> = <span class="stringliteral">&quot;/kobuki&quot;</span>;
    <span class="comment">// Most people will prefer to do their own velocity smoothing/acceleration limiting.</span>
    <span class="comment">// If you wish to utilise kobuki&#39;s minimal acceleration limiter, set to true </span>
    parameters.<a class="code" href="classkobuki_1_1Parameters.html#ab6eaa092677b34a152c9a11dfd3ff56f" title="Enable or disable the acceleration limiter [true].">enable_acceleration_limiter</a> = <span class="keyword">false</span>; 
    <span class="comment">// If your battery levels are showing significant variance from factory defaults, adjust thresholds. </span>
    <span class="comment">// This will affect the led on the front of the robot as well as when signals are emitted by the driver.</span>
    parameters.<a class="code" href="classkobuki_1_1Parameters.html#a0c7b04175141d702f520c4a963876143" title="Capacity voltage of the battery [16.5V].">battery_capacity</a> = 16.5;
    parameters.<a class="code" href="classkobuki_1_1Parameters.html#afbe3833926add7263db592c6b0116b36" title="Threshold for battery level warnings [14.0V].">battery_low</a> = 14.0;
    parameters.<a class="code" href="classkobuki_1_1Parameters.html#a6332cc2748b6f7095e1eb463a024289d" title="Threshold for battery level in danger of depletion [13.2V].">battery_dangerous</a> = 13.2;

    <span class="comment">// initialise - it will throw an exception if parameter validation or initialisation fails.</span>
    <span class="keywordflow">try</span> {
      <a class="code" href="classKobukiManager.html#aedbd8a41454f86c36938b15481688d4c">kobuki</a>.<a class="code" href="classkobuki_1_1Kobuki.html#a0648c958434e641d4573721541099ee4">init</a>(parameters);
    } <span class="keywordflow">catch</span> ( ecl::StandardException &amp;e ) {
      std::cout &lt;&lt; e.what();
    }
  }
<span class="keyword">private</span>:
  <a class="code" href="classkobuki_1_1Kobuki.html" title="The core kobuki driver class.">kobuki::Kobuki</a> <a class="code" href="classKobukiManager.html#aedbd8a41454f86c36938b15481688d4c">kobuki</a>;
};

<span class="keywordtype">int</span> <a class="code" href="initialisation_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {
  <a class="code" href="classKobukiManager.html">KobukiManager</a> kobuki_manager;
  <span class="keywordflow">return</span> 0;
}
</pre></div><p>If you compile and run this program, you should hear kobuki's starting up chirp followed immediately by the shutting down chirp.</p>
<h2><a class="anchor" id="kobukiLibraryApi"></a>
Library Api</h2>
<h3><a class="anchor" id="kobukiRawData"></a>
Raw Data</h3>
<p>The kobuki driver runs a background thread which continually retrieves packets from the kobuki, saving the raw data, and additionally doing some processing before updating the current state of the robot.</p>
<p>Raw data can be accessed at any time by one of the following getXXX commands:</p>
<ul>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a33ff3a81a9a43c025da6efb21dc0ac9b">kobuki::Kobuki::getCoreSensorData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a8af97d7fdc4bd55f1172e5b9b421f343">kobuki::Kobuki::getDockIRData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a75ed69becc3058d2a9525cfbe81aabe1">kobuki::Kobuki::getCliffData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a7e32d9b2879ed4fa50a233bb4fed8413">kobuki::Kobuki::getCurrentData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a2ab9631196aa4211b9b6b1634ab9b5f5">kobuki::Kobuki::getGpInputData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a7dd63be4984cc95c72aa2fa9dcd0f9d1">kobuki::Kobuki::getInertiaData</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#ae3d74aafb393b426069b196e04b09574">kobuki::Kobuki::getRawInertiaData</a></li>
</ul>
<p>The gyro provides both filtered yaw angle as well as unfiltered 3-axis inertial data hence the two calls above.</p>
<h3><a class="anchor" id="kobukiProcessedData"></a>
Processed Data and Status</h3>
<p>The following are convenience methods for accessing the current state of the robot</p>
<ul>
<li><a class="el" href="classkobuki_1_1Kobuki.html#ada9c8b518d41ceaf9326de577eec2d2b">kobuki::Kobuki::batteryStatus</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#af72c123e33ca1882f25800c9af5fb717">kobuki::Kobuki::getHeading</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a2a64a16a6c4b587627f5a304359ec641">kobuki::Kobuki::getAngularVelocity</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a2b45e19fa61a2c542dcae5a7973dd28f">kobuki::Kobuki::versionInfo</a> : hardware, firmware and software version strings.</li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a70e163fcf282a169a1c1c7cbb8564294">kobuki::Kobuki::getWheelJointStates</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a395e07e7e4c32117471c4ec8459b73c5">kobuki::Kobuki::isAlive</a> : true if a kobuki is detected and streaming data.</li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a3c250f1d287ebe46c4711307c1d99d59">kobuki::Kobuki::isEnabled</a> : true if the motor power is enabled</li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a96f16e56b7483d3dad75b63ce10f91a5">kobuki::Kobuki::isShutdown</a> : true if the worker threads for this driver have been shut down.</li>
</ul>
<h3><a class="anchor" id="kobukiSoftCommands"></a>
Soft Commands</h3>
<ul>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a9a8e7a0dfa5c9fd447d2791217ca1bca">kobuki::Kobuki::resetOdometry</a></li>
</ul>
<h3><a class="anchor" id="kobukiHardCommands"></a>
Hard Commands</h3>
<ul>
<li><a class="el" href="classkobuki_1_1Kobuki.html#af016306e3114daf0c61ffbaae0b3d1a0">kobuki::Kobuki::setBaseControl</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#acfa8adb823fe03d7223d41a13d8e66cf">kobuki::Kobuki::setLed</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a188d1db38aa059f96e3bfb0879b244f8">kobuki::Kobuki::setDigitalOutput</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#a53a52a4a94507afe3ce30a0f6dfbefdf">kobuki::Kobuki::setExternalPower</a></li>
<li><a class="el" href="classkobuki_1_1Kobuki.html#afaf3bd9ab3e781fec84200041ed95f30">kobuki::Kobuki::playSoundSequence</a></li>
</ul>
<h3><a class="anchor" id="differentialDriverModule"></a>
The Differential Drive Module</h3>
<p>The final function of importance is the <a class="el" href="classkobuki_1_1Kobuki.html#a1c1cf4b6b10d5d18109430d764763544">kobuki::Kobuki::updateOdometry</a> method. This updates the current odometry state of the robot, fusing encoder and gyro heading data with the previous known state. For deterministic odometry, it is important this method is called each time a new data packet from the kobuki arrives. Refer to the <a class="el" href="enSimpleExample.html">simple control loop example</a> for more information and working code to illustrate. </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://ros.org/wiki/kobuki_driver">kobuki_driver</a><br />
Author(s): Daniel Stonier <stonier@yujinrobot.com>, Younghun Ju <yhju@yujinrobot.com>, Jorge Santos Simon <jorge@yujinrobot.com></br />
<small>autogenerated on Fri Aug 23 2013 15:06:50</small>
</div>
</body>
</html>
