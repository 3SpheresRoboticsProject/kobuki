<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>kobuki_driver: Appendix : Protocol Specification</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Appendix : Protocol Specification </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="enOverview"></a>
Overview</h2>
<p>The <a class="el" href="classkobuki_1_1Kobuki.html">kobuki driver</a> communicates with the robot by using predefined protocol. In general, the driver sends the commands to the robot and the robot sends some feedback data or sensor readings. These commands and feedback data are converted into bytestreams for communication via serial interface. The protocol specifies that rules and forms of bytestreams.</p>
<h2><a class="anchor" id="enBytestream"></a>
Structure of Bytestream</h2>
<p>A bytestream can be devided into 4 fields; Headers, Length, Payload and Checksum.</p>
<table class="doxtable">
<tr align="center">
<th>Name</th><td>Header 0</td><td>Header 1</td><td>Length</td><td>Payload</td><td>Checksum </td></tr>
<tr align="center">
<th>Size</th><td>1 Byte</td><td>1 Byte</td><td>1 Byte</td><td>N Bytes</td><td>1 Byte </td></tr>
<tr align="center">
<th align="center">Description</th><td width="100">0xAA<br/>
(Fixed)</td><td width="100">0x55<br/>
(Fixed)</td><td width="100">Size of payload in bytes</td><td width="100">Described below</td><td width="100">XOR'ed value of every bytes of bytesream except headers </td></tr>
</table>
<p><br/>
</p>
<h3><a class="anchor" id="enHeader"></a>
Header</h3>
<p>Two bytes of headers, header 0 and hader 1, are fixed value for both bytestreams, commands and feedback data. This headers are used to detect the starting point of bytestream.</p>
<p><br/>
</p>
<h3><a class="anchor" id="enLength"></a>
Length</h3>
<p>Length indicated the length of following bytes that single bytestream hold. Default size of this field is 1 byte. Length can be used to distinguish each bytestreams. Minimum value of this field is 3.</p>
<p><br/>
</p>
<h3><a class="anchor" id="enPayload"></a>
Payload</h3>
<p>Payload contains actual data of bytestream.</p>
<p><br/>
</p>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<h4><a class="anchor" id="enStructureOfPayload"></a>
Structure Of Payload</h4>
<dl class="user"><dt><b></b></dt><dd>Payload is a consist of several sub-payloads.</dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr align="center">
<td colspan="5">Payload </td></tr>
<tr align="center">
<td>Sub-Payload 0</td><td>Sub-Payload 1</td><td>Sub-Payload 2</td><td>...</td><td>Sub-Payload N-1 </td></tr>
</table>
</dd></dl>
<p><br/>
</p>
<h4><a class="anchor" id="enStructureOfSubPayloads"></a>
Structure Of Sub-Payloads</h4>
<dl class="user"><dt><b></b></dt><dd>Sub-payload can be devided into three parts, Header, Length and Data.</dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr align="center">
<th>Name</th><td>Header</td><td>Length</td><td>Data </td></tr>
<tr align="center">
<th>Size</th><td>1 Byte</td><td>1 Byte</td><td>N Byte(s) </td></tr>
<tr align="center">
<th align="center">Description</th><td width="100">Predefined Identifier</td><td width="100">Size of data in byte(s)</td><td width="100">Described below </td></tr>
</table>
</dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enChecksum"></a>
Checksum</h3>
<p>Checksum is XOR'ed value of entire bytestream except headers. Checksum process ensure the integrity of bytestreams.</p>
<p>Here is simple code snippet for it. </p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> packet_size(buffer.size());
<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cs(0);
<span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 2; i &lt; packet_size; i++)
{
  cs ^= buffer[i];
}
<span class="keywordflow">return</span> cs ? <span class="keyword">false</span> : <span class="keyword">true</span>;
</pre></div><p><br/>
</p>
<h3><a class="anchor" id="enEntireBytestream"></a>
Entire Bytestream</h3>
<table class="doxtable">
<tr align="center">
<td colspan="2">Headers</td><td rowspan="2">Length</td><td colspan="5">Payload</td><td rowspan="2">Checksum </td></tr>
<tr align="center">
<td>Header 0</td><td>Header 1</td><td>Sub-Payload 0</td><td>Sub-Payload 1</td><td>Sub-Payload 2</td><td>...</td><td>Sub-Payload N-1 </td></tr>
</table>
<p>Above table shows the structure of entire bytestream.</p>
<p>Minimum length of payload is 3; Payload with a sub-payload, that has only 1 byte data.</p>
<p>Theoretical minimum length of entire packet(bytestream) is 7.</p>
<p><br/>
</p>
<h2><a class="anchor" id="enDataTypes"></a>
Data Types</h2>
<p>Data field in Sub-payload is a mixture of below three data types; byte, short and int. </p>
<table class="doxtable">
<tr align="center">
<th>Name</th><th>Description</th><th>Byte Length</th><th>Bit Length</th><th>Data Range</th><th colspan="2">C/C++ Identifier </th></tr>
<tr align="center">
<td>Unsigned Byte</td><td>8-bit unsigned integer</td><td>1</td><td>8</td><td>0~255</td><td>unsigend char</td><td>uint8_t </td></tr>
<tr align="center">
<td>Unsigned Short</td><td>16-bit unsigned integer</td><td>2</td><td>16</td><td>0~65,535</td><td>unsigend short</td><td>uint16_t </td></tr>
<tr align="center">
<td>Unsigned Int</td><td>32-bit unsigned integer</td><td>4</td><td>32</td><td>0~4,294,967,295</td><td>unsigend int</td><td>uint32_t  </td></tr>
</table>
<p><br/>
</p>
<h3><a class="anchor" id="enSerializationDerialization"></a>
Serialization-Deserialization</h3>
<p><a href="http://en.wikipedia.org/wiki/Serialization">Serialization</a> is the process of converting a data sturcture into a bytestream. Deserialization is reversal process. Each data types are serialized and deserialized by `<a href="http://en.wikipedia.org/wiki/Least_significant_byte">LSB</a>-First Order`. It means Least Significant Bytes will comes first on the bytestream. For example, The integer number 2,864,434,397(0xAABBCCDD) can be serialized into: </p>
<table class="doxtable">
<tr>
<td>0xDD</td><td>0xCC</td><td>0xBB</td><td>0xAA </td></tr>
</table>
<p>So, 0xDD will arrive first in bytestream.</p>
<p>Here are template functions to handle it on kobuki_deriver, <a class="el" href="classpacket__handler_1_1payloadBase.html#a367c89d2f4ed8a587956f99e62cf865a">buildVariable()</a> and <a class="el" href="classpacket__handler_1_1payloadBase.html#ab614ccfc29826da5758ae165cb7eabf6">buildBytes()</a>.</p>
<p><br/>
</p>
<h2><a class="anchor" id="enCommandPackets"></a>
Command Packets</h2>
<h3><a class="anchor" id="enCommandIdentifier"></a>
Command Identifier</h3>
<table class="doxtable">
<tr>
<th>ID</th><th>Name</th><th>Description </th></tr>
<tr>
<td align="center">1</td><td>Base Control</td><td>Control wheel motors </td></tr>
<tr>
<td align="center">2</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">3</td><td>Sound</td><td>Play custom sounds </td></tr>
<tr>
<td align="center">4</td><td>Sound Sequence</td><td>Play predefined sounds </td></tr>
<tr>
<td align="center">5</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">6</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">7</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">8</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">9</td><td>Request Extra</td><td>Request extra informations </td></tr>
<tr>
<td align="center">10</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">11</td><td><em>Reserved</em></td><td></td></tr>
<tr>
<td align="center">12</td><td>General Purpose Output</td><td>Control general purpose outputs </td></tr>
</table>
<p><br/>
</p>
<h3><a class="anchor" id="enBaseControl"></a>
Base Control</h3>
<p>Control wheel motors to moving robot. Robot will follow the arc, which radius is <b>&lt;Radius&gt;</b> mm, with <b>&lt;Velocity&gt;</b> mm/s.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">1</td><td>0x01</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">4</td><td>0x04</td><td>Fixed </td></tr>
<tr>
<th rowspan="2">Data</th><td>Speed</td><td align="center">2</td><td align="center"></td><td></td><td>in mm/s </td></tr>
<tr>
<td>Radius</td><td align="center">2</td><td align="center"></td><td></td><td>in mm </td></tr>
</table>
<p><br/>
</p>
<h3><a class="anchor" id="enSound"></a>
Sound</h3>
<p>Play custom sounds with note and duration.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">3</td><td>0x03</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">3</td><td>0x03</td><td>Fixed </td></tr>
<tr>
<th rowspan="2">Data</th><td>Note</td><td align="center">2</td><td align="center"></td><td></td><td><img class="formulaInl" alt="$\mbox{1/}(f \cdotp a)$" src="form_0.png"/>, where <img class="formulaInl" alt="$f$" src="form_1.png"/> is frequency of sound in Hz, and <img class="formulaInl" alt="$a$" src="form_2.png"/> is 0.00000275 </td></tr>
<tr>
<td>Duration</td><td align="center">1</td><td align="center"></td><td></td><td>Duration of playing note in mili-seconds </td></tr>
</table>
<dl class="warning"><dt><b>Warning:</b></dt><dd>This command is implemented on the kobuki with firmware, but not implemented yet on driver software(kobuki_driver).</dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enSoundSequence"></a>
Sound Sequence</h3>
<p>Play predefined sounds by its index.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">4</td><td>0x04</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">1</td><td>0x01</td><td>Fixed </td></tr>
<tr>
<th>Data</th><td>Sequence number</td><td align="center">1</td><td align="center"></td><td></td><td>0 for ON sound<br/>
1 for OFF sound<br/>
2 for RECHARGE sound<br/>
3 for BUTTON sound<br/>
4 for ERROR sound<br/>
5 for CLEANINGSTART sound<br/>
6 for CLEANINGEND sound </td></tr>
</table>
<p><br/>
</p>
<h3><a class="anchor" id="enRequestExtra"></a>
Request Extra</h3>
<p>Request extra data from robot. Especially version info of kobuki; Hardware Version, Firmware Version and Unique Deivce IDentifier(UDID)</p>
<p>UDID is unique to device. so can be used to identify on multiple robots.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">9</td><td>0x09</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">2</td><td>0x02</td><td>Fixed </td></tr>
<tr>
<th>Data</th><td>Reqeust flags</td><td align="center">2</td><td align="center"></td><td></td><td>Set the flags to request extra data<br/>
0x01 for Hardware Version<br/>
0x02 for Firmware Version<br/>
0x08 for Unique Device ID </td></tr>
</table>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="enAppendixProtocolSpecification.html#enHardwareVersion">Hardware Version</a> <a class="el" href="enAppendixProtocolSpecification.html#enFirmwareVersion">Firmware Version</a>, <a class="el" href="enAppendixProtocolSpecification.html#enUniqueDeviceIDentifier">Unique Device IDentifier(UDID)</a></dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enGeneralPurposeOutput"></a>
General Purpose Output</h3>
<p>This command has multiple roles. It controls LEDs, digital outputs and external powers.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">12</td><td>0x0C</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">2</td><td>0x02</td><td>Fixed </td></tr>
<tr>
<th>Data</th><td>Digital output flags</td><td align="center">2</td><td align="center"></td><td></td><td>Set the flags to set high on output pins of expansion port<br/>
0x0001 for digital output ch. 0<br/>
0x0002 for digital output ch. 1<br/>
0x0004 for digital output ch. 2<br/>
0x0008 for digital output ch. 3<br/>
<br/>
Set the flags to turn on external powers<br/>
0x0010 for external power 3.3V ch.<br/>
0x0020 for external power 5V ch.<br/>
0x0040 for external power 12V/5A ch.<br/>
0x0080 for external power 12V/1.5A ch.<br/>
<br/>
Set the flags to turn on LEDs<br/>
0x0100 for red colour of LED1<br/>
0x0200 for green colour of LED1<br/>
0x0400 for red colour of LED2<br/>
0x0800 for green colour of LED2<br/>
 </td></tr>
</table>
<p><br/>
</p>
<h2><a class="anchor" id="enFeedbackPackets"></a>
Feedback Packets</h2>
<h3><a class="anchor" id="enFeedbackIdentifier"></a>
Feedback Identifier</h3>
<p>Kobuki sends below default feedbacks periodically in 50 Hz, when it powered on.</p>
<table class="doxtable">
<tr>
<th>ID</th><th>Name</th><th>Description</th><th>Availability </th></tr>
<tr>
<td align="center">1</td><td>Basic Sensor Data</td><td>Basic core sensor data</td><td>By default </td></tr>
<tr>
<td align="center">2</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">3</td><td>Docking IR</td><td>Signals from docking station</td><td>By default </td></tr>
<tr>
<td align="center">4</td><td>Inertial Sensor</td><td>Gyro data both angle and angular velocity</td><td>By default </td></tr>
<tr>
<td align="center">5</td><td>Cliff</td><td>PSD data facing floor</td><td>By default </td></tr>
<tr>
<td align="center">6</td><td>Current</td><td>Current of wheel motors</td><td>By default </td></tr>
<tr>
<td align="center">7</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">8</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">9</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">10</td><td>Hardware Version</td><td>Version number of kobuki hardware</td><td>On request </td></tr>
<tr>
<td align="center">11</td><td>Firmware Version</td><td>Version number of kobuki firmware</td><td>On request </td></tr>
<tr>
<td align="center">12</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">13</td><td>Raw data of 3-axis gyro</td><td>Raw ADC data of digital 3-axis gyro</td><td>By default </td></tr>
<tr>
<td align="center">14</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">15</td><td>Reserved</td><td></td><td></td></tr>
<tr>
<td align="center">16</td><td>General Purpose Input</td><td>Inputs from 25-pin expansion port</td><td>By default </td></tr>
<tr>
<td align="center">17</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">18</td><td><em>Reserved</em></td><td></td><td></td></tr>
<tr>
<td align="center">19</td><td>Unique Device IDentifier(UDID)</td><td>Unique number to identify robot</td><td>On request </td></tr>
<tr>
<td align="center">20</td><td><em>Reserved</em></td><td></td><td></td></tr>
</table>
<p><br/>
</p>
<h3><a class="anchor" id="enBasicSensorData"></a>
Basic Sensor Data</h3>
<p>Basic core sensor data.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Feedback Identifier</td><td align="center">1</td><td align="center">1</td><td>0x01</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">15</td><td>0x0F</td><td>Fixed </td></tr>
<tr>
<th rowspan="12">Data</th><td>Timestamp</td><td align="center">2</td><td align="center"></td><td></td><td>Timestamp generated internally in milliseconds<br/>
It circulates from 0 to 65535 </td></tr>
<tr>
<td>Bumper</td><td align="center">1</td><td align="center"></td><td></td><td>Flag will be setted when bumper is pressed<br/>
0x01 for right bumper<br/>
0x02 for central bumper<br/>
0x04 for left bumper </td></tr>
<tr>
<td>Wheel drop</td><td align="center">1</td><td align="center"></td><td></td><td>Flag will be setted when wheel is dropped<br/>
0x01 for right wheel<br/>
0x02 for left wheel </td></tr>
<tr>
<td>Cliff</td><td align="center">1</td><td align="center"></td><td></td><td>Flag will be setted when cliff is detected<br/>
0x01 for right cliff sensor<br/>
0x02 for central cliff sensor<br/>
0x04 for left cliff sensor </td></tr>
<tr height="30">
<td>Left encoder</td><td align="center">2</td><td align="center"></td><td></td><td rowspan="2">Accumulated encoder data of left and right wheels in ticks<br/>
Increments of this value means forward direction<br/>
It circulates from 0 to 65535 </td></tr>
<tr height="30">
<td>Right encoder</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr height="30">
<td>Left PWM</td><td align="center">1</td><td align="center"></td><td></td><td rowspan="2">PWM value that applied to left and right wheel motor<br/>
This data should be converted signed type to represent correctly<br/>
Negative sign indicated backward direction </td></tr>
<tr height="30">
<td>Right PWM</td><td align="center">1</td><td align="center"></td><td></td></tr>
<tr>
<td>Button</td><td align="center">1</td><td align="center"></td><td></td><td>Flag will be setted when button is pressed<br/>
0x01 for Button 0<br/>
0x02 for Button 1<br/>
0x04 for Button 2 </td></tr>
<tr>
<td>Charger</td><td align="center">1</td><td align="center"></td><td></td><td>0 for DISCHARGING state<br/>
2 for DOCKING_CHARGED state<br/>
6 for DOCKING_CHARGING state<br/>
18 for ADAPTER_CHARGED state<br/>
22 for ADAPTER_CHARGING state </td></tr>
<tr>
<td>Battery</td><td align="center">1</td><td align="center"></td><td></td><td>Voltage of battery in 0.1 V<br/>
Typically 16.7 V when fully charged </td></tr>
<tr>
<td>Over current flags</td><td align="center">1</td><td align="center"></td><td></td><td>Flag will be setted when over current is detected<br/>
0x01 for left wheel<br/>
0x02 for right wheel </td></tr>
</table>
<dl class="note"><dt><b>Note:</b></dt><dd>This sub-payload will be sent by default.</dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enDockingIR"></a>
Docking IR</h3>
<p>Signals from the docking station.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">3</td><td>0x03</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">3</td><td>0x03</td><td>Fixed </td></tr>
<tr height="40">
<th rowspan="3">Data</th><td>Right signal</td><td align="center">1</td><td align="center"></td><td></td><td rowspan="3">Flag will be setted when signal is detected<br/>
0x01 for NEAR_LEFT state<br/>
0x02 for NEAR_CENTER state<br/>
0x04 for NEAR_RIGHT state<br/>
0x08 for FAR_CENTER state<br/>
ox10 for FAR_LEFT state<br/>
0x20 for FAR_RIGHT state </td></tr>
<tr height="40">
<td>Central signal</td><td align="center">1</td><td align="center"></td><td></td></tr>
<tr height="40">
<td>Left signal</td><td align="center">1</td><td align="center"></td><td></td></tr>
</table>
<p>Kobuki's docking station has 3 <a href="http://en.wikipedia.org/wiki/Infrared">IR</a> emitters. The emitted IR lights cover three regions in front of the docking station: left, central and right, each divided in two sub-fields: near and far. Each beam encodes this information, so the robot knows at any moment in which region and sub-field he is. Also, as regions and fields are independently identified, they can be overlap on its borders. </p>
<div class="image">
<img src="dock_ir_fields.png" alt="dock_ir_fields.png"/>
<div class="caption">
Docking IR Fields</div></div>
<p> <br/>
</p>
<h3><a class="anchor" id="enInertialSensorData"></a>
Inertial Sensor Data</h3>
<p>Inertial sensor data. Only 1 axis gyro data only available.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">4</td><td>0x04</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">7</td><td>0x07</td><td>Fixed </td></tr>
<tr>
<th rowspan="5">Data</th><td>Angle</td><td align="center">2</td><td align="center"></td><td></td><td>Factory calibrated </td></tr>
<tr>
<td>Angle rate</td><td align="center">2</td><td align="center"></td><td></td><td>Factory calibrated </td></tr>
<tr>
<td>Unused</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
</table>
<dl class="note"><dt><b>Note:</b></dt><dd>This sub-payload will be sent by default.</dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enCliffSensorData"></a>
Cliff Sensor Data</h3>
<p>This sub-payload provides <a href="http://en.wikipedia.org/wiki/Analog-to-digital_converter">ADC</a> data of <a href="http://en.wikipedia.org/wiki/Position_sensitive_device">PSD</a>, which is facing the floor.</p>
<p>This value is related with distance between sensor and floor surface. See the <a href="http://www.beck-elektronik.de/fileadmin/templates/beck_folder/opto/sensor/sharp/analog-gp2y0a51sk0f.pdf">datasheet</a> for more detailed information.</p>
<p>This data also available in the Cliff field of <a class="el" href="enAppendixProtocolSpecification.html#enBasicSensorData">Basic Sensor Data</a> , as a boolean type, processed on the kobuki.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">5</td><td>0x05</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">6</td><td>0x06</td><td>Fixed </td></tr>
<tr>
<th rowspan="3">Data</th><td>Right cliff sensor</td><td align="center">2</td><td align="center"></td><td></td><td rowspan="3">ADC output of each PSD<br/>
Data range: 0 ~ 4095<br/>
Distance range: 2 ~ 15 cm<br/>
Distance is non-linear </td></tr>
<tr>
<td>Central cliff sensor</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>Left cliff sensor</td><td align="center">2</td><td align="center"></td><td></td></tr>
</table>
<dl class="note"><dt><b>Note:</b></dt><dd>This sub-payload will be sent by default.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="enAppendixProtocolSpecification.html#enBasicSensorData">Basic Sensor Data</a></dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enCurrent"></a>
Current</h3>
<p>Current sensor readings of wheel motors.</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">6</td><td>0x06</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">2</td><td>0x02</td><td>Fixed </td></tr>
<tr>
<th rowspan="2">Data</th><td>Left motor</td><td align="center">2</td><td align="center"></td><td></td><td>in 10mA </td></tr>
<tr>
<td>Right motor</td><td align="center">2</td><td align="center"></td><td></td><td>in 10mA </td></tr>
</table>
<dl class="note"><dt><b>Note:</b></dt><dd>This sub-payload will be sent by default.</dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enHardwareVersion"></a>
Hardware Version</h3>
<p>Hardware version info in triplet form; &lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">10</td><td>0x0A</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">4</td><td>0x04</td><td>Fixed </td></tr>
<tr>
<th rowspan="4">Data</th><td>Patch</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Minor</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Major</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">1</td><td align="center">0</td><td>0x00</td><td>Fixed </td></tr>
</table>
<dl class="note"><dt><b>Note:</b></dt><dd>This sub-payload will be sent on request. </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="enAppendixProtocolSpecification.html#enRequestExtra">Request Extra</a></dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enFirmwareVersion"></a>
Firmware Version</h3>
<p>Firmware version info in triplet form; &lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">11</td><td>0x0B</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">4</td><td>0x04</td><td>Fixed </td></tr>
<tr>
<th rowspan="4">Data</th><td>Patch</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Minor</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Major</td><td align="center">1</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">1</td><td align="center">0</td><td>0x00</td><td>Fixed </td></tr>
</table>
<dl class="note"><dt><b>Note:</b></dt><dd>This sub-payload will be sent on request. </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="enAppendixProtocolSpecification.html#enRequestExtra">Request Extra</a></dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enRawDataOf3DGyro"></a>
Raw Data Of 3D Gyro</h3>
<p>Raw ADC data of digital 3D gyro; <a href="http://www.st.com/internet/analog/product/250373.jsp">L3G4200D</a></p>
<p>Due to difference of acquisition rate and update rate, 2-3 data will be arrived at once.</p>
<p>Digit to deg/s ratio is 0.00875, it comes from <a href="http://www.st.com/internet/com/TECHNICAL_RESOURCES/TECHNICAL_LITERATURE/DATASHEET/CD00265057.pdf">datasheet</a> of 3d gyro.</p>
<table class="doxtable">
<tr>
<th></th><th colspan="2">Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td colspan="2">Identifier</td><td align="center">1</td><td align="center">13</td><td>0x0D</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td colspan="2">Size of data field</td><td align="center">1</td><td align="center">2+6N</td><td></td><td></td></tr>
<tr>
<th rowspan="9">Data</th><td colspan="2">Frame id</td><td align="center">1</td><td align="center"></td><td></td><td>Frame id of 'Raw gyro data 0'<br/>
Every sensor readings can identified by frame id<br/>
, It circulate from 0 to 255 </td></tr>
<tr>
<td colspan="2">Followed data length</td><td align="center">1</td><td align="center">3N</td><td></td><td></td></tr>
<tr>
<td rowspan="3">Raw gyro data 0</td><td>x-axis</td><td align="center">2</td><td align="center"></td><td></td><td rowspan="7">ADC output of each-axis in 0.00875 deg/s </td></tr>
<tr>
<td>y-axis</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>z-axis</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td colspan="5" align="center">:<br/>
: </td></tr>
<tr>
<td rowspan="3">Raw gyro data N-1</td><td>x-axis</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>y-axis</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>z-axis</td><td align="center">2</td><td align="center"></td><td></td></tr>
</table>
<dl class="note"><dt><b>Note:</b></dt><dd>This sub-payload will be sent by default.</dd></dl>
<p><br/>
</p>
<dl class="warning"><dt><b>Warning:</b></dt><dd>Sensing axis of 3d gyro is not match with robot. It is rotated 90 degree counterclockwise about z-axis. So, below conversion will needed. <div class="fragment"><pre class="fragment"><span class="keyword">const</span> <span class="keywordtype">double</span> digit_to_dps = 0.00875;
angular_velocity.x =  -digit_to_dps * (short)raw_gyro_data.y;
angular_velocity.y =   digit_to_dps * (<span class="keywordtype">short</span>)raw_gyro_data.x;
angular_velocity.z =   digit_to_dps * (short)raw_gyro_data.z;
</pre></div></dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enGeneralPurposeInput"></a>
General Purpose Input</h3>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">16</td><td>0x10</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">16</td><td>0x10</td><td>Fixed </td></tr>
<tr>
<th rowspan="8">Data</th><td>Digital input</td><td align="center">2</td><td align="center"></td><td></td><td>Flag will be setted, when high voltage is applied<br/>
0x01 for digital input ch. 0<br/>
0x02 for digital input ch. 1<br/>
0x04 for digital input ch. 2<br/>
0x08 for input output ch. 3 </td></tr>
<tr>
<td>Analog input ch.0</td><td align="center">2</td><td align="center"></td><td></td><td rowspan="4">12-bit ADC output of each channel<br/>
Data range: 0 ~ 4095(2^12-1)<br/>
Conversion voltage range: 0 ~ 3.3 V </td></tr>
<tr>
<td>Analog input ch.1</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>Analog input ch.2</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>Analog input ch.3</td><td align="center">2</td><td align="center"></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">2</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">2</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>Unused</td><td align="center">2</td><td align="center"></td><td></td><td></td></tr>
</table>
<dl class="note"><dt><b>Note:</b></dt><dd>This sub-payload will be sent by default.</dd></dl>
<p><br/>
</p>
<h3><a class="anchor" id="enUniqueDeviceIDentifier"></a>
Unique Device IDentifier(UDID)</h3>
<p>Contains Unique Device IDentifier of robot. This value is unique for all robot in the world. It can be represented by triplet form: &lt;UDID0&gt;-&lt;UDID1&gt;-&lt;UDID2&gt;</p>
<table class="doxtable">
<tr>
<th></th><th>Name</th><th width="40">Size</th><th width="40">Value</th><th>Value in Hex</th><th>Description </th></tr>
<tr>
<th>Header</th><td>Identifier</td><td align="center">1</td><td align="center">19</td><td>0x13</td><td>Fixed </td></tr>
<tr>
<th>Length</th><td>Size of data field</td><td align="center">1</td><td align="center">12</td><td>0x0C</td><td>Fixed </td></tr>
<tr>
<th rowspan="4">Data</th><td>UDID0</td><td align="center">4</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>UDID1</td><td align="center">4</td><td align="center"></td><td></td><td></td></tr>
<tr>
<td>UDID2</td><td align="center">4</td><td align="center"></td><td></td><td></td></tr>
</table>
<dl class="note"><dt><b>Note:</b></dt><dd>This sub-payload will be sent on request. </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="enAppendixProtocolSpecification.html#enRequestExtra">Request Extra</a></dd></dl>
<p><br/>
 </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://ros.org/wiki/kobuki_driver">kobuki_driver</a><br />
Author(s): Daniel Stonier <stonier@yujinrobot.com>, Younghun Ju <yhju@yujinrobot.com>, Jorge Santos Simon <jorge@yujinrobot.com></br />
<small>autogenerated on Fri Aug 23 2013 15:06:50</small>
</div>
</body>
</html>
